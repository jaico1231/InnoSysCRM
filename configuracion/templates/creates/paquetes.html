{% extends 'layout/base.html'%}

{%block title%}{{ title }}{%endblock%}
{% block stylesheets %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" integrity="sha512-mSYL/HkXjOoSh8an/6JWnvmzkhS4HRzYRwZvnmhPxYBXAb1hcqXdvigEFbEfjf1n+ZUyVTRFVSNRQcf2tPzxQw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js" integrity="sha512-T/tUfKSV1bihCnd+MxKD0Hm1uBBroVYBOYSk1knyvQ9VyZJpc/ALb4P0r9uboCVPPLMTiCT8Y8XdHHBHhVxX3Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

{% endblock stylesheets %}
{% block content %}

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header card-header-primary">
            <div class="col-md-12" style="text-align: right;">
              <button type="button" class="btn-close BtnCancel col-md-2"></button>
          </div>
            <h4 class="card-title">{{ title }}</h4>
            <p class="card-category"></p>
          </div>
          <div class="card-body">
            <div class="container-fluid">
              <div class="row">
                <div class="col-lg-12 d-flex align-items-strech">                  
                  <div class="card w-100">
                    <div class="card-body">
                      <div class="d-sm-flex d-block align-items-center justify-content-between mb-9">                        
                        <div class="card-body">
                          <div class="profile-container">

    
                                <div class="form-group">
                                    {{ form.nombre.label_tag }}
                                    {{ form.nombre }}
                                </div>
                                
                                <div class="form-group">
                                    {{ form.codigo.label_tag }}
                                    {{ form.codigo }}
                                </div>
                                <div class="form-group">
                                  {{ form.servicios.label_tag }}
                                  {{ form.servicios }}  <!-- Este es el campo ModelMultipleChoiceField -->
                                  {{ form.servicios.errors }}
                              </div>
                                <div class="form-group">
                                    {{ form.servicios.label_tag }}
                                    <div class="row">
                                      <div class="row">
                                        <div class="col-md-5">
                                            <label>Servicios Disponibles</label>
                                            <input type="text" class="form-control mb-2" id="search-available" placeholder="Buscar...">
                                            <select id="available-services" class="form-select" multiple="" size="10">
                                                {% for servicio in form.servicios %}
                                                    <option value="{{ servicio.id }}">{{ servicio.codigo }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                
                                        <div class="col-md-2 text-center d-flex align-items-center justify-content-center">
                                            <div class="btn-group-vertical">
                                                <button type="button" class="btn btn-primary" id="add-selected">&gt;</button>
                                                <button type="button" class="btn btn-primary" id="remove-selected">&lt;</button>
                                            </div>
                                        </div>
                                
                                        <div class="col-md-5">
                                            <label>Servicios Seleccionados</label>
                                            <input type="text" class="form-control mb-2" id="search-selected" placeholder="Buscar...">
                                            <select id="selected-services" class="form-select" multiple="" size="10" name="servicios">
                                                {% for servicio in form.servicios.value %}
                                                    <option value="{{ servicio.id }}" selected>{{ servicio.nombre }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    </div>
                                </div>    
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="card-footer">
            <button type="submit" class="btn btn-primary btn-xs">
              <i class="material-icons ">save</i>Agregar 
            </button>
            <button type="button" class="btn btn-secundary BtnCancel">
              <i class="material-icons ">cancel</i>Cancelar
            </button>
          </div>
        </div>
      </div>
    </div>  
</form>
{% endblock content %}

{% block javascripts %}
<script>
    document.getElementById('add-selected').onclick = function() {
        moveSelected('available-services', 'selected-services');
    };

    document.getElementById('remove-selected').onclick = function() {
        moveSelected('selected-services', 'available-services');
    };

    function moveSelected(fromId, toId) {
        var from = document.getElementById(fromId);
        var to = document.getElementById(toId);
        Array.from(from.selectedOptions).forEach(function(option) {
            to.appendChild(option);
        });
    }

    document.getElementById('search-available').oninput = function() {
        filterOptions('available-services', this.value);
    };

    document.getElementById('search-selected').oninput = function() {
        filterOptions('selected-services', this.value);
    };

    function filterOptions(selectId, query) {
        var options = document.getElementById(selectId).options;
        Array.from(options).forEach(function(option) {
            option.style.display = option.text.toLowerCase().includes(query.toLowerCase()) ? 'block' : 'none';
        });
    }
</script>
{% endblock javascripts %}